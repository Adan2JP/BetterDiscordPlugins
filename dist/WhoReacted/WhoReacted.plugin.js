/**!
 * @name WhoReacted
 * @description Shows the avatars of the users who reacted to a message.
 * @version 1.2.0
 * @author Jaime Filho
 * @authorId 289112759948410881
 * @invite z6Yx9A8VDR
 * @website https://github.com/jaimeadf/BetterDiscordPlugins/tree/release/src/WhoReacted
 * @source https://github.com/jaimeadf/BetterDiscordPlugins/tree/release/src/WhoReacted
 * @updateUrl https://raw.githubusercontent.com/jaimeadf/BetterDiscordPlugins/release/dist/WhoReacted/WhoReacted.plugin.js
 */(()=>{"use strict";var e={886:(e,t,s)=>{s.d(t,{Z:()=>a});const r=global.BdApi.React;var n=s.n(r);function o(e,t){return null!=e?e:t()}function i(e){let t,s=e[0],r=1;for(;r<e.length;){const n=e[r],o=e[r+1];if(r+=2,("optionalAccess"===n||"optionalCall"===n)&&null==s)return;"access"===n||"optionalAccess"===n?(t=s,s=o(s)):"call"!==n&&"optionalCall"!==n||(s=o(((...e)=>s.call(t,...e))),t=void 0)}return s}const a=([e,t])=>{const{Settings:s,WebpackModules:r,PluginUtilities:a,Patcher:c,Toasts:l,DiscordSelectors:u,ReactTools:d,Utilities:h}=t,{SettingPanel:p,Textbox:g,Slider:m,Switch:f}=s,b=r.getByProps("Store","connectStores"),w=r.getByProps("getReactions","_changeCallbacks"),y=r.find((e=>"Reactions"===i([e,"optionalAccess",e=>e.default,"optionalAccess",e=>e.displayName]))).default,S=r.find((e=>"VoiceUserSummaryItem"===i([e,"optionalAccess",e=>e.default,"optionalAccess",e=>e.displayName]))).default;function R({count:e,max:t,users:s}){return n().createElement(S,{className:"who-reacted-reactors",max:t,users:s,renderMoreUsers:function(s,r){return n().createElement("div",{className:`${r} more-reactors`,children:"+"+(1+e-t)})}})}R=b.connectStores([w],(({message:e,emoji:t})=>({users:Object.values(o(w.getReactions(e.getChannelId(),e.id,t),(()=>({}))))})))(R);return class extends e{get css(){return"\n                .who-reacted-reactors:not(:empty) {\n                    margin-left: 6px;\n                }\n              \n                .who-reacted-reactors .more-reactors {\n                    background-color: var(--background-tertiary);\n                    color: var(--text-normal);\n                    font-weight: 500;\n                }\n            "}constructor(){super(),this.defaultSettings={maxUsersShown:6,reactionThreshold:10,userThreshold:100,useHighestUserCount:!0}}async onStart(){a.addStyle(this.getName(),this.css),await this.patchReaction()}onStop(){a.removeStyle(this.getName()),c.unpatchAll()}loadSettings(e){const t=super.loadSettings(e);return t.reactionThreshold=o(t.countOfEmojisToHideUsers,(()=>t.reactionThreshold)),t.userThreshold=o(t.countOfReactionsOnEmojiToHideUsers,(()=>t.userThreshold)),delete t.countOfEmojisToHideUsers,delete t.countOfReactionsOnEmojiToHideUsers,t}buildSettingsPanel(){return new p((()=>{this.saveSettings(),this.forceUpdateAllReactions()}),new g("Max users shown","The maximum number of users shown for each reaction emoji.",this.settings.maxUsersShown,(e=>{if(isNaN(e)||e<1||e>99)return l.error("Value must be a number between 1 and 99!");this.settings.maxUsersShown=parseInt(e)})),new m("Reaction threshold","Hides the reactors when the number of separate reactions is exceeded on a message. Set to 0 to disable.",0,20,this.settings.reactionThreshold,(e=>this.settings.reactionThreshold=e),{markers:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],stickToMarkers:!0}),new m("User threshold","Hides the reactors when their count is exceeded on a message. Set to 0 to disable.",0,1e4,this.settings.userThreshold,(e=>this.settings.userThreshold=e),{markers:[0,10,20,50,100,500,1e3,2e3,3e3,4e3,5e3,1e4],stickToMarkers:!0,equidistant:!0}),new f("Use highest user count","Uses the reaction with most reactors of a message for user threshold.",this.settings.useHighestUserCount,(e=>this.settings.useHighestUserCount=e)))}getSettingsPanel(){return this.buildSettingsPanel().getElement()}async patchReaction(){const e=await this.findReaction(),t=({reactions:e})=>{const{reactionThreshold:t,userThreshold:s,useHighestUserCount:r}=this.settings;if(0!==t&&e.length>t)return!1;if(0!==s){if((r?Math.max(...e.map((e=>e.count))):e.reduce(((e,t)=>e+t.count),0))>s)return!1}return!0};c.after(e.prototype,"render",((e,s,r)=>{const{message:o,emoji:i,count:a}=e.props;if(!t(o))return;const c=r.props.children;r.props.children=e=>{const t=c(e),s=t.props.children.props.children,r=s.props.children;return s.props.children=e=>{const t=r(e);return t.props.children.props.children.push(n().createElement(R,{message:o,emoji:i,count:a,max:this.settings.maxUsersShown})),t},t}})),this.forceUpdateAllReactions()}findReaction(){return new Promise((e=>{const t=document.querySelector(u.Reactions.reaction);if(t)return e(this.findReactionReactInstance(t).type);const s=c.after(y.prototype,"render",((t,r,n)=>{if(!n)return;const o=n.props.children[0][0];o&&(s(),e(o.type))}))}))}forceUpdateAllReactions(){for(const e of document.querySelectorAll(u.Reactions.reaction))this.findReactionReactInstance(e).stateNode.forceUpdate()}findReactionReactInstance(e){return h.findInTree(d.getReactInstance(e),(e=>"Reaction"===i([e,"optionalAccess",e=>e.type,"optionalAccess",e=>e.displayName])),{walkable:["return"]})}}}},127:(e,t,s)=>{s.d(t,{default:()=>m});const r=require("fs");var n=s.n(r);const o=require("path");var i=s.n(o);const a=require("request");var c=s.n(a);const l=require("electron");var u=s.n(l);const d=global.ZeresPluginLibrary;var h=s.n(d),p=s(886);const g={info:{name:"WhoReacted",description:"Shows the avatars of the users who reacted to a message.",version:"1.2.0",authors:[{name:"Jaime Filho",discord_id:"289112759948410881"}],github:"https://github.com/jaimeadf/BetterDiscordPlugins/tree/release/src/WhoReacted",github_raw:"https://raw.githubusercontent.com/jaimeadf/BetterDiscordPlugins/release/dist/WhoReacted/WhoReacted.plugin.js"}},m=h()?(0,p.Z)(h().buildPlugin(g)):class{constructor(){this._config=g}getName(){return g.info.name}getAuthor(){return g.info.authors.map((e=>e.name)).join(", ")}getDescription(){return g.info.description}getVersion(){return g.info.version}load(){BdApi.showConfirmationModal("Library plugin is needed",`The library plugin needed for ${g.info.name} is missing. Please click Download Now to install it.`,{confirmText:"Download",cancelText:"Cancel",onConfirm(){c().get("https://rauenzi.github.io/BDPluginLibrary/release/0PluginLibrary.plugin.js",((e,t,s)=>{if(e)return u().shell.openExternal("https://betterdiscord.net/ghdl?url=https://raw.githubusercontent.com/rauenzi/BDPluginLibrary/master/release/0PluginLibrary.plugin.js");n().writeFileSync(i().join(BdApi.Plugins.folder,"0PluginLibrary.plugin.js"),s)}))}})}start(){}stop(){}}}},t={};function s(r){var n=t[r];if(void 0!==n)return n.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,s),o.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s(886);var r=s(127);module.exports=r.default})();